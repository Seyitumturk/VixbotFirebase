<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="/products.css">
    <link href="https://cdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

</head>


<body>
    <div class="wrapper">

        <div id="bigSidebar"
            class="flex flex-col items-center w-64 h-full overflow-hidden text-gray-400 bg-gray-900 rounded ">
            <a class="flex items-center w-full px-3 mt-3" href="#">
                <svg class="w-14 h-14 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                    fill="currentColor">
                    <path
                        d="M11 17a1 1 0 001.447.894l4-2A1 1 0 0017 15V9.236a1 1 0 00-1.447-.894l-4 2a1 1 0 00-.553.894V17zM15.211 6.276a1 1 0 000-1.788l-4.764-2.382a1 1 0 00-.894 0L4.789 4.488a1 1 0 000 1.788l4.764 2.382a1 1 0 00.894 0l4.764-2.382zM4.447 8.342A1 1 0 003 9.236V15a1 1 0 00.553.894l4 2A1 1 0 009 17v-5.764a1 1 0 00-.553-.894l-4-2z" />
                </svg>
                <span class="ml-2 text-sm font-bold">VixBot</span>
            </a>
            <a class="flex items-center w-full h-12 px-3 mt-2 rounded hover:bg-gray-700 hover:text-gray-300 mt-20"
                href="/conversations">
                <!-- ... -->
                <span class="ml-2 text-sm font-medium">Ideate</span>
            </a>
            <!-- ... -->
            <!-- Products link -->
            <a class="flex items-center w-full h-12 px-3 mt-2 rounded hover:bg-gray-700 hover:text-gray-300"
                href="/products">
                <!-- ... -->
                <span class="ml-2 text-sm font-medium">Products</span>
            </a>
            <!-- Templates link -->
            <a class="flex items-center w-full h-12 px-3 mt-2 rounded hover:bg-gray-700 hover:text-gray-300"
                href="/templates">
                <!-- Add an appropriate SVG icon for Templates -->
                <span class="ml-2 text-sm font-medium">Templates</span>
            </a>
            <a class="flex items-center w-full h-12 px-3 mt-2 rounded hover:bg-gray-700 hover:text-gray-300"
                href="/conversations">
                <!-- Add an appropriate SVG icon for Templates -->
                <span class="ml-2 text-sm font-medium">Collaborate</span>
            </a>



        </div>
        <div class="main-content">

            <!-- Page content -->
            <div class="container-fluid mt--7">
                <!-- Header -->
                <div class="row">
                    <div class="col">
                        <div class="card shadow">
                            <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
                                <h3 class="mb-0">Products</h3>
                                <button id="add-product-btn" class="btn btn-primary">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products container -->
                <div class="row" id="products-container">
                    <!-- Newly created products will be added here -->
                </div>

                <!-- Create Product Modal -->
                <div class="modal" id="create-product-modal">
                    <div class="blur"></div>
                    <div class="modal-content">
                        <h3 class="mb-4">Create a New Product</h3>
                        <form id="create-product-form" method="POST" action="/create-product">
                            <div id="product-name-group">
                                <label for="product-name">Product Name:</label>
                                <input type="text" class="form-control" id="product-name" name="product_name" required>
                            </div>
                            <div id="main-features-group" class="hidden">
                                <label for="main-features">Main Features:</label>
                                <textarea class="form-control" id="main-features" name="main_features" rows="3"
                                    required></textarea>
                            </div>
                            <div id="unique-selling-points-group" class="hidden">
                                <label for="unique-selling-points">Unique Selling Points:</label>
                                <textarea class="form-control" id="unique-selling-points" name="unique_selling_points"
                                    rows="3" required></textarea>
                            </div>
                            <div id="pricing-model-group" class="hidden">
                                <label for="pricing-model">Pricing Model:</label>
                                <input type="text" class="form-control" id="pricing-model" name="pricing_model"
                                    required>
                            </div>
                            <div id="distribution-channels-group" class="hidden">
                                <label for="distribution-channels">Distribution Channels:</label>
                                <input type="text" class="form-control" id="distribution-channels"
                                    name="distribution_channels" required>
                            </div>
                        </form>

                        <div class="mt-4">
                            <button type="button" class="btn btn-secondary mr-2" id="cancel-btn">Cancel</button>
                            <button type="button" class="btn btn-primary" id="next-btn">Next</button>
                            <button type="button" class="btn btn-primary" id="submit-btn">Submit</button>
                        </div>
                    </div>
                </div>


                <!-- ... -->

            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // Handle the "Add Product" button click event
            $("#add-product-btn").on("click", function () {
                $("#create-product-modal").show();
            });

            // Handle the "Cancel" button click event
            $("#cancel-btn").on("click", function () {
                $("#create-product-modal").hide();
            });

            // Setup modal question flow
            const questionGroups = [
                "product-name-group",
                "main-features-group",
                "unique-selling-points-group",
                "pricing-model-group",
                "distribution-channels-group",
            ];

            let currentQuestionIndex = 0;
            function showQuestion(index) {
                questionGroups.forEach((group, i) => {
                    $(`#${group}`).css("display", index === i ? "block" : "none");
                });
                $("#next-btn").css("display", index < questionGroups.length - 1 ? "inline-block" : "none");
                $("#submit-btn").css("display", index === questionGroups.length - 1 ? "inline-block" : "none");
            }

            $("#next-btn").on("click", function () {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            });

            // When the modal is shown, display the first question
            $("#create-product-modal").on("shown.bs.modal", function () {
                currentQuestionIndex = 0;
                showQuestion(currentQuestionIndex);
            });

            // Handle the form submission
            $("#submit-btn").on("click", async function (event) {
                event.preventDefault();

                const formData = {
                    product_name: $("#product-name").val(),
                    main_features: $("#main-features").val(),
                    unique_selling_points: $("#unique-selling-points").val(),
                    pricing_model: $("#pricing-model").val(),
                    distribution_channels: $("#distribution-channels").val(),
                };

                try {
                    const response = await $.ajax({
                        type: "POST",
                        url: "/create-product",
                        data: formData,
                        dataType: "json",
                    });

                    // Create a new product card with the received data and append it to the products container
                    const productCardHtml = `
            <div class="col-sm-6 col-lg-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">${response.template.product_name}</h5>
                        <p class="card-text">${response.template.main_features}</p>
                    </div>
                </div>
            </div>`;
                    $("#products-container").append(productCardHtml);

                } catch (error) {
                    console.error("Server response:", error.responseText);
                    alert("Failed to create a new product. Please try again.");
                }
            });
        });



    </script>


</body>